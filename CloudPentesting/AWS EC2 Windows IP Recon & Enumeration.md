### Phase 1: Initial Passive Reconnaissance (No Direct Interaction)

Start here to gather intel without alerting the target or generating logs. This minimizes footprint and provides baseline context for an AWS EC2 Windows instance.

1. WHOIS and ASN Lookup  
    Run `whois <IP>` (or use online tools like whois.arin.net).  
    _Reasoning_: Reveals owner (likely Amazon), allocation details, and abuse contacts. Confirms AWS ownership and any associated domains/orgs. For EC2, expect AS16509 (Amazon ASN).
    
2. DNS Enumeration
    
    - Forward/reverse DNS: `nslookup <IP>` and `dig -x <IP>`.
    - Subdomain brute: `dnsrecon -d <suspected-domain>.amazonaws.com -t brt` or `gobuster dns -d <domain> -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-5000.txt`.  
        _Reasoning_: EC2 IPs often reverse to ec2-xx-xx-xx-xx.compute-1.amazonaws.com, leaking region (e.g., us-east-1). Subdomains might expose related services.
3. Passive OSINT via Shodan/Censys  
    Search Shodan: `ip:"<IP>"` or `hostname:"ec2-<IP>.compute.amazonaws.com"`. Same for Censys.io.  
    _Reasoning_: Pulls historical port scans, services, SSL certs, and tags without touching the host. Windows EC2 often shows RDP (3389), HTTP/HTTPS, or AWS metadata endpoints.
    
4. SSL/TLS Cert Recon  
    `echo | openssl s_client -connect <IP>:443 2>/dev/null | openssl x509 -noout -text` (if HTTPS responds).  
    _Reasoning_: Certs may reveal hostnames, SANs, expiration, and CA—useful for vhost enumeration later.
    

### Phase 2: Active Port Scanning and Service Discovery

Now actively probe to map attack surface. Use efficient, stealthy scans first, escalate to aggressive.

1. Quick TCP Connect Scan  
    `nmap -sT -Pn -T4 --top-ports 1000 <IP>`  
    _Reasoning_: Fast identification of open ports (e.g., 3389/RDP, 80/443/HTTP/S, 445/SMB for Windows shares). Skip host discovery (-Pn) as it's a known live IP; -T4 balances speed/aggressiveness.
2. Full Aggressive Service Enumeration  
    `nmap -sC -sV -sU -p- -T4 -A -oA <IP>-full <IP>`  
    _Reasoning_: -sC (default scripts), -sV (version detection), -sU (UDP, catches Windows DNS/SSDP), -p- (all 65k ports), -A (OS detection, traceroute, scripts). Scripts detect Windows version (e.g., Win10/11/Server2019), RDP encryption, SMB signing. UDP vital for Windows (NetBIOS, RPC).
    
3. Windows-Specific Scripting  
    Add to Nmap: `--script smb*,rdp*,msrpc*,ssl*` or dedicated run: `nmap --script smb-enum*,smb-ls*,rdp-enum-encryption -p445,3389 <IP>`.  
    _Reasoning_: Enumerates SMB shares/users/policies (e.g., anonymous access), RDP security (NLA?), RPC endpoints for EternalBlue-like checks.
    

### Phase 3: Windows Service Deep Dive

Target common Windows/EC2 exposures. Prioritize high-impact services.

1. SMB Enumeration
    
    - `enum4linux -a <IP>` or `smbclient -L //<IP>/ -N`.
    - `crackmapexec smb <IP> -u '' -p '' --shares` (anonymous).  
        _Reasoning_: Windows loves SMB (445). Leaks shares, users, perms, OS build (e.g., vulnerable to PrintNightmare). Null sessions often work on misconfigs.
2. RDP Enumeration
    
    - `rdp-sec-check.sh <IP>` or `nmap --script rdp* <IP> -p3389`.
    - `crowbar -b rdp -s <IP>/32 -u /usr/share/seclists/Usernames/Directory-Usernames.txt -c /usr/share/wordlists/rockyou.txt`.  
        _Reasoning_: RDP is default on Windows EC2. Check NLA, cred stuffing (weak defaults like admin/admin). Bruteforce if low-hanging.
3. HTTP/HTTPS Enumeration
    
    - `gobuster dir -u http://<IP> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x asp,aspx,html`.
    - `nikto -h <IP>` and `whatweb <IP>`.  
        _Reasoning_: IIS common on Windows. Vhost fuzz: `gobuster vhost -u http://<IP> -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-20000.txt`. Reveals web apps, ASP.NET versions for MS vulns.
4. WinRM/Other Protocols  
    `crackmapexec winrm <IP>` and check ports 5985/5986.  
    _Reasoning_: WinRM for PSRemoting; often exposed if PowerShell scripts run.
    

### Phase 4: Vulnerability Scanning and Exploit Checks

Aggressively hunt flaws with zero-days in mind (post-Nov 2024, verify CVEs manually).

1. Automated Vuln Scan  
    `nessus` or `openvas` full scan; alternatively, `nuclei -u <IP> -t cves/ -t windows/`.  
    _Reasoning_: Detects CVEs like BlueKeep (RDP), SMBGhost, or unpatched IIS. Nuclei is fast/scriptable for custom templates.
2. Manual Exploit Probing
    
    - EternalBlue/MS17-010: `metasploit ms17_010_eternalblue`.
    - PrintNightmare (CVE-2021-34527): Check with `nmap --script smb-vuln-cve2021-34527`.  
        _Reasoning_: Windows EC2 often lags patches. Chain with shell if RCE hits.

### Phase 5: Credential Attacks and Post-Exploitation Prep

If services found, brute/guesser.

1. Hydra/Brute Force  
    `hydra -L users.txt -P pass.txt <IP> rdp` (RDP); same for SMB/winrm/http-post-form.  
    _Reasoning_: Defaults like Administrator/empty or seasonal passwords common.
    
2. AWS Metadata Check (if shell gained)  
    From shell: `powershell "Invoke-RestMethod -Uri http://169.254.169.254/latest/meta-data/"`.  
    _Reasoning_: EC2 IMDSv1 leaks IAM roles/keys—huge priv esc.