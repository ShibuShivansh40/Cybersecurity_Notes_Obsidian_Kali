### Configuring CloudGate on AWS
To configure Cloud Gate on AWS, we need to first install Terraform on Kali Linux. To do that, download the AMD64 Binary on Kali and then run the below script:
```
cd Downloads
unzip <filename>.zip
terraform -h
sudo cp terrform /usr/local/bin
```
And now terraform is accessible wherever we call it.

Then we are required to install jq using the command : `sudo apt install jq` 
And to install the Git repository using as Python Library, we will use the command : `pipx install git+https://github.com/RhinoSecurityLabs/cloudgoat.git `
```
‚îå‚îÄ‚îÄ(shibushivansh„âøshibu)-[~/Scripts]
‚îî‚îÄ$ pipx install git+https://github.com/RhinoSecurityLabs/cloudgoat.git
  installed package cloudgoat 2.3.1, installed using Python 3.13.9
  These apps are now globally available
    - cloudgoat
done! ‚ú® üåü ‚ú®
```

Then we are required to create a user with some IAM Permissions. We'll go to Amazon Console > Users > Give Username > Attach Policy Directly > AdminstrativeAccess > Create User.

And then we will fetch the Access Key by creating them up.

Then use the command : `aws configure --profile shibu_cloadgoat` and enter the Access Key ID and Secret Access Key.
```
‚îå‚îÄ‚îÄ(shibushivansh„âøshibu)-[~]
‚îî‚îÄ$ aws sts get-caller-identity --profile shibu_cloudgoat
{
    "UserId": "AIDA6AIOUUF2USO2KZCF6",
    "Account": "962640257397",
    "Arn": "arn:aws:iam::962640257397:user/shibu_cloudgoat"
}

‚îå‚îÄ‚îÄ(shibushivansh„âøshibu)-[~]
‚îî‚îÄ$ cloudgoat config aws
No configuration file was found at /home/shibushivansh/.local/share/pipx/venvs/cloudgoat/lib/python3.13/site-packages/cloudgoat/config.yml.
Would you like to create this file with a default aws setting now? [y/n]: y
Enter the name of your default AWS profile: shibu_cloudgoat
A default aws setting of "shibu_cloudgoat" has been saved.

‚îå‚îÄ‚îÄ(shibushivansh„âøshibu)-[~]
‚îî‚îÄ$ cloudgoat config whitelist --auto
No whitelist.txt file was found at /home/shibushivansh/.local/share/pipx/venvs/cloudgoat/lib/python3.13/site-packages/cloudgoat/whitelist.txt

CloudGoat can automatically make a network request, using https://ifconfig.co to find your IP address, and then overwrite the contents of the whitelist file with the result.
Would you like to continue? [y/n]: y

whitelist.txt created with IP address 115.241.35.34/32

```

And using all these 3 commands, finally CloudGoat is installed and ready to work for us.

### Installing Pacu on Kali
To install Pacu on Kali, we use the command : `pipx install git+https://github.com/RhinoSecurityLabs/pacu.git`
```
‚îå‚îÄ‚îÄ(shibushivansh„âøshibu)-[~/Scripts]
‚îî‚îÄ$ pipx install git+https://github.com/RhinoSecurityLabs/pacu.git
‚ö†Ô∏è  Note: pacu was already on your PATH at /usr/bin/pacu
  installed package pacu 1.6.1, installed using Python 3.13.9
  These apps are now globally available
    - pacu
done! ‚ú® üåü ‚ú®
```

### IAM For Pentesters

Things we need to check for :
- **Privilege Escalation**  
    Can I go from a low-privilege user to an admin? This is the most common and most impactful finding in cloud environments.
- **Lateral Movement**  
    Even if I can‚Äôt get admin access, can I move sideways into another user, role, or resource with sensitive access‚Äîlike an S3 bucket full of data?
- **Data Exfiltration**  
    Can I take over a Lambda function and send data to my own server?
- **Persistence**  
    If I can create access keys for another user, I can quietly backdoor their account without changing their password. That kind of access is hard to detect unless you‚Äôve got solid logging and alerting in place.

When you‚Äôre reviewing IAM permissions, here are four things you should always check:

1. **Users with excessive permissions**
2. **Roles that can be assumed**
3. **Policies that use wildcards** (e.g., `"Action": "*"` or `"Resource": "*"`)
4. **Services or Lambda functions with elevated permissions** that you can potentially abuse

![[Pasted image 20251217143842.png]]
Now here we can see that the user has the privilege of doing any action to any resource because of the presence of * in there.

IAM Enumeration Cheat Sheet
1. List IAM Users : `aws iam list-users`

2. Get User Permissions: 
	1. List attached managed policies: `aws iam list-attached-user-policies --user-name [user-name]`
	2. List inline policies

aws iam list-user-policies --user-name [user-name]

c. Get inline policy details

aws iam get-user-policy --user-name [user-name] --policy-name [policy-name]

3. List IAM Groups and Permissions
a. List groups for a user

aws iam list-groups-for-user --user-name [user-name]

b. List group policies

aws iam list-attached-group-policies --group-name [group-name]
aws iam list-group-policies --group-name [group-name]

c. Get inline group policy details

aws iam get-group-policy --group-name [group-name] --policy-name [policy-name]

4. List IAM Roles and Permissions
a. List all roles

aws iam list-roles

b. Get role details (trust policy)

aws iam get-role --role-name [role-name]

c. List attached policies

aws iam list-attached-role-policies --role-name [role-name]

d. List inline policies

aws iam list-role-policies --role-name [role-name]

e. Get inline role policy details

aws iam get-role-policy --role-name [role-name] --policy-name [policy-name]

5. Get and Decode Policy Documents
a. Get a managed policy document (by ARN or name)

aws iam get-policy --policy-arn [policy-arn]
aws iam get-policy-version --policy-arn [policy-arn] --version-id [version-id]

6. View Full IAM Snapshot
a. Dump all IAM permissions (users, roles, groups, policies)

aws iam get-account-authorization-details

    Use this to build a full IAM permissions map. Add --filter to target roles/users/groups specifically.