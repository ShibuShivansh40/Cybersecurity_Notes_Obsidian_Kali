Organization
	--> Folders
		--> Projects
			--> Resources
			
**Organization** : The Organization resource is the root node in the Google Cloud resource hierarchy and is the hierarchical super node of projects.

**Folders** : Folders are nodes in the Cloud Platform Resource Hierarchy. A folder can contain projects, other folders, or a combination of both.

Organizations can use folders to group projects under the organization node in a hierarchy.

**Project** : A GCP Project is basically a collection of various GCP services such as compute instances, storage buckets, Cloud run containers, etc. that are grouped together since they serve one application or project in the corporate terminology.

### GCP Service Account
Equivalent to role in AWS and Managed Identities in Azure. By default service account never expire and did not have MFA. Very interesting account for attackers.

A service account is a special kind of account used by an application or GCP compute instance.

Service account act as a identity as well as a resource: - Service account as identity - Where we need GCP resource access without human intervention - Service account as resource - Where we need access on other service accounts –> Service account is associated within a project and uniquely identity by it’s email address.


### Default Service Account
- Automatically created within a project (Ex: User create a new compute instance)
	– App Engine: Default Service Account: PROJECT_ID@appspot.gserviceaccount.com
	– Compute Engine: Default Service Account: PROJECT_NUMBER-compute@developer.gserviceaccount.com

>The Compute Engine default service account is created with the IAM basic Editor role. They have this permission on Project level.


**User Managed Service Account** : 
- Created and managed by end user when required :  SERVICE_ACCOUNT_NAME@PROJECT_ID.iam.gserviceaccount.com

To view their permissions you can copy theses managed service account role to a custom one. `gcloud iam roles copy`


**GCloud CLI**
• https://cloud.google.com/sdk/docs/cheatsheet –> Google Cloud CLI is aset of tools to create and manage Google Cloud resources. Through click on the web console or GCloud CLI you will directly talk to Control Plan APIs (Restfull).

Obtaining User Access Tokens
As mentionned previously 2 types of accounts exist within GCP : - User accounts (user credentials) - Service accounts (service account credentials)

Secret in user credentials files takes the form of a long-lived refresh tokens .

–> You usually obtain (authorized) user credential files by through the underly- ing command, which initiates an OAuth 2.0 authorization code grant. `gcloud auth application-default login`
–> This will produce a credential file called : `application_default_credentials.json`
–> Located at : `~/.config/gcloud`
This refresh token can be used to obain access tokens using OAuth 2.0 refresh token grant.

As an attacker some actions or tools required an access tokens to operate. In fact the refresh token grant action only requires a single call to retrieve a valid access token.
```
curl --location --request POST "https://oauth2.googleapis.com/token" --header "Content-Type:
'client_id': 'XXXXXXXXXX-XXXXXXXXXXXX.apps.googleusercontent.com',
'client_secret': 'X-XXXXXXXXXXXXXXXX',
'refresh_token': 'XXXXXXXXXXXXXXXXXXXXXXXXXX',
'grant_type': 'refresh_token'
}"
```
–> The response is an access token and an ID token.
Note 1 : You can modify the access token scopes by specifying scopes in your request, although you cannot increase beyond the scopes of the original refresh token.
Note 2 : The scope ending cloud-platform gives you access to pretty much all GCP resources.
